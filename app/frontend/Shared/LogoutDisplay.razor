@inject NavigationManager Nav
@inject ILogger<LogoutDisplay> Logger
@inject ApiClient ApiClient


@if (ShowLogoutButton)
{
    <MudButton Variant="Variant.Filled" EndIcon="@Icons.Material.Filled.Logout" Color="Color.Inherit" OnClick="SignOut">@User</MudButton>
}

@code {
    [Parameter] public bool ShowLogoutButton { get; set; } = true;

    public string _user = "USER";
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        try
        {
            Logger.LogInformation("start retrieve logout button visibility.");
            ShowLogoutButton = await ApiClient.ShowLogoutButtonAsync();
            if (ShowLogoutButton)
            {
                _user = await ApiClient.GetUserAsync();
            }
        }
        catch(Exception e)
        {
            Logger.LogError(e.Message);
        }
    }

    private void SignOut()
    {
        Logger.LogInformation("User start logged out.");
        Nav.NavigateTo(".auth/logout", true);
    }
}